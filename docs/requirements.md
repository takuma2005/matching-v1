# センパイ（Senpai）要件定義書 v1.0（MVP）

本書は「先輩に教えてもらう青春体験」を核とした学習マッチングアプリのMVP要件を定義する。技術選定に依存しない、プロダクト視点の要件とする。

---

## 1. サービス概要

### 1.1 コンセプト

- 「先生と生徒」ではなく「先輩と後輩」の関係で、気軽に学べる体験を提供する。
- 相談のしやすさ、即マッチング、リーズナブルな価格、青春感のある体験を重視。

### 1.2 価値提供

- 後輩: 年齢の近い先輩に、塾より気軽・安価に相談できる。
- 先輩: 得意科目で収入と経験を得られ、後輩の成長に貢献できる。

### 1.3 ターゲット

- 先輩（教える側）: 高校生以上（16歳〜）。大学生・大学院生中心。未成年は保護者簡易同意。
- 後輩（教わる側）: 小学生〜大学生を中心に、先輩より年下の学習者。

### 1.4 ロール

- 後輩、先輩、保護者（簡易同意）、管理者（審査/通報対応/返金裁定/出金確認）。

---

## 2. 用語とビジネスルール

### 2.1 コイン体系

- 基本換算: 1コイン = 1.25円（税抜/税込の扱いはアプリ内表記に合わせて明示）。
- コイン購入プラン（手数料込み。追加手数料なし）:
  - ¥490 = 400コイン（お試し）
  - ¥1,480 = 1,250コイン（人気No.1）
  - ¥4,900 = 4,300コイン（1ヶ月分）
  - ¥9,800 = 8,800コイン（お得パック）
- コイン有効期限: MVPでは【無期限】（将来は法令・会計要件に応じ見直し）。

### 2.2 料金・手数料

- マッチング料: 300コイン（初回マッチ成立時のみ）。
- 授業料: 先輩が自由設定。全カテゴリ統一最低料金 1,200コイン/時（¥1,500相当）。
- 出金手数料: 出金額が10万円以下は300コイン、10万円超は無料。
- プラットフォーム収益: コイン販売の差額（20%）+ マッチング料 +（一部出金手数料）。授業料からの手数料は【0%】。

### 2.3 エスクローと返金

- 授業申請時: 後輩の残高から授業料相当コインを【仮押さえ】。
- 先輩承認時: エスクロー状態に移行。
- 授業完了時: 後輩の完了操作で先輩へコイン送金。
- 返金/キャンセル（MVP）:
  - 先輩未承認: 全額リリース（後輩に戻す）。
  - 承認後〜授業開始前: 基本全額返金（トラブル最小化のため）。
  - 授業開始後: 当事者の合意で割合返金/支払い。合意不可は管理者裁定。

### 2.4 年齢・安全（MVP方針）

- MVPでは年齢確認は簡易実装（自己申告 + 未成年の保護者簡易同意ログ）。
- 年齢差ガイドラインはアプリ内で【注意喚起】表示。厳格な年齢差制限・本人確認はPhase2で強化。

---

## 3. MVP機能要件（必須）

1. 会員登録/認証（SMS）

- 後輩・先輩の役割選択。未成年は保護者同意チェック（簡易）。
- 簡潔な初回登録（姓名/学校/学年/生年月日/性別/居住エリア）。
- 受け入れ条件:
  - SMSコード一致で新規登録/ログインできる。
  - 未成年登録時に保護者同意のチェックと記録が残る。

2. プロフィール（必要最小）

- 項目: 名前、学校、学年、科目（タグ）、性別、生年月日、（先輩のみ）料金設定、オンライン可否、自己紹介。
- 受け入れ条件:
  - 先輩は時給を1,200〜2,400コインで設定でき、最低1,200コイン未満は保存不可。
  - 科目は複数選択可、プロフィールはいつでも更新可。

3. 先輩一覧

- シンプルなカードリスト（スワイプ不要）。要素: 写真/名前/学校/評価/料金/オンライン可否。
- 基本検索/フィルタ: 科目、料金帯、地域、オンライン可、並び替え（おすすめ/料金/評価）。
- 受け入れ条件:
  - 条件指定で一覧が更新される。
  - 空の結果時は代替提案（人気カテゴリなど）を表示。

4. マッチング

- フロー: 後輩が申請（メッセージ必須20文字以上）→ 300コイン支払い → 先輩が承認で成立。
- 受け入れ条件:
  - 300コイン不足時は購入導線を提示。
  - 申請メッセージは20文字未満では送信不可。
  - 承認/拒否の結果が双方に通知される。

5. チャット（テキストのみ）

- マッチ成立ユーザー間の1:1メッセージ。既読/未読、通報/ブロック。
- 受け入れ条件:
  - 送受信でき、最新メッセージが一覧の上位に表示。
  - 不適切報告で管理者へ通知、対象ユーザーのブロックが即時反映。

6. 授業予約（チャット内）

- チャットから「授業を申請」→ 日時/科目/時間/金額 → 申請で仮押さえ → 先輩承認でエスクロー → 実施 → 後輩完了で送金。
- 受け入れ条件:
  - 申請時に必要コインが仮押さえされる。
  - 承認後は双方の予定に登録される。
  - 後輩が完了操作すると先輩へ送金される。

7. コイン購入

- 4プランの購入。価格/コイン数/お得ラベル表示。
- 受け入れ条件:
  - 購入完了で残高・履歴が即時反映。
  - 追加手数料なしの明確表示。

8. コイン管理

- 残高表示、履歴（購入/マッチング料/授業仮押さえ/送金/返金）。
- 受け入れ条件:
  - 直近のトランザクションが新しい順で確認できる。
  - フィルタ（期間/種別）で絞り込みできる。

9. プッシュ通知

- 申請、承認/拒否、メッセージ受信、授業リマインド、送金完了を即時通知。

10. 最低限の安全機能

- 通報/ブロック、利用規約/ガイドライン同意、年齢差注意喚起、ユーザー削除/退会。

---

## 4. 画面構成 / ナビゲーション（MVP）

- ボトムナビ（5タブ）: ホーム / 探す / チャット / 授業 / マイページ
- ホーム: ウェルカム文言、コイン残高カード（購入導線）、クイックアクション（探す/予定）、おすすめ先輩カード。
- 探す: 「センパイを探す / 後輩を探す」切替、科目/料金/オンライン/地域フィルタ、結果リスト。
- プロフィール詳細: 自己紹介、科目、料金、レビュー（将来）、マッチング申請ボタン（300コイン表示）。
- チャット: 一覧 + ルーム（「授業を申請」導線）。
- 授業: 予定一覧（承認済/申請中/完了）、詳細（ステータス/金額/操作）。
- マイページ: ユーザー情報、コイン残高・履歴、コイン購入、設定、通報/ブロック管理。

---

## 5. 主要ユーザーフロー

### 5.1 後輩フロー

1. 会員登録（SMS）→ プロフィール作成 → コイン購入（任意）→ 先輩一覧 → マッチング申請（300コイン）→ 承認 → チャット → 授業申請 → 実施 → 完了送金。

### 5.2 先輩フロー

1. 会員登録 → 料金・科目設定 → 申請受領 → 承認/拒否 → チャット → 授業承認 → 実施 → コイン受取 → 出金申請。

### 5.3 授業（エスクロー）フロー

申請（仮押さえ）→ 先輩承認（エスクロー）→ 実施 → 後輩完了（送金）→ 出金。

---

## 6. 非機能要件（MVP目標）

- パフォーマンス: 主要画面の体感応答 < 1.5秒、チャット送信 < 1秒。
- 可用性: 月間稼働率 99.5% 以上（MVP）。
- セキュリティ: すべてHTTPS、パスワード/トークンの安全保管、重要操作の監査ログ。
- プライバシー: 未成年の同意ログ保管、個人情報の最小収集、削除請求に対応。
- アクセシビリティ: 重要ボタンのタッチ領域 ≥ 44pt、主要色のコントラストはWCAG AA。
- ログ/監視: 重要イベント（認証/決済/エスクロー/送金/通報）を記録、簡易ダッシュボード。

---

## 7. コンプライアンスと安全

- 未成年保護: 保護者簡易同意の取得・保管、違反時のアカウント制限。
- チャットガイドライン: 個人情報の過度共有・出会い目的・不適切表現の禁止、通報で即時レビュー。
- 年齢差の注意: アプリ内にガイド表示。厳密な年齢差制限/本人確認/KYCはPhase2で導入予定。
- 返金/紛争解決: 申請画面と規約でポリシー明示。紛争は管理者が最終裁定。

---

## 8. 概念データモデル（参考）

- User（共通）: id, 役割, 基本情報, 年齢, 地域, 同意情報（保護者含む）
- Profile（先輩/後輩）: 科目タグ, 自己紹介, 料金（先輩）, オンライン可否
- Match: 申請者, 相手, 申請メッセージ（20字以上）, ステータス（申請中/承認/拒否/取消）
- ChatMessage: 送信者, 受信者, 本文, 既読, 送信時刻
- Lesson: 参加者, 日時, 科目, 時間, 金額, ステータス（申請/承認/実施/完了/取消）
- CoinAccount: 残高, 更新日時
- CoinTransaction: 種別（購入/マッチ料/仮押さえ/送金/返金/出金手数料）, 金額, 関連エンティティ
- PayoutRequest: 先輩, 金額, 手数料, ステータス
- Report: 通報種別, 通報者, 対象, 状態, 対応履歴

---

## 9. スコープ外 / 次フェーズ（例）

- Phase2: 本人確認（公的証明/KYC）、年齢差制限の自動適用、画像/ファイル送受信、音声通話/ビデオ、詳細レビュー、レコメンド強化、キャンセルポリシーの細分化。

---

## 10. KPI（初期）

- マッチング成立率、申請→承認率、初回授業完了率、コイン購入CVR、1ユーザーあたり平均授業回数、紛争率。

---

## 11. 技術要件

### 11.1 フロントエンド技術スタック

- **React Native**: 0.79.6 (クロスプラットフォーム開発)
- **Expo SDK**: ~54.0.0 (開発・ビルド環境)
- **TypeScript**: ~5.8.3 (型安全性確保)
- **React Navigation**: v6 (画面遷移管理)
- **Expo Vector Icons**: アイコン表示

### 11.2 バックエンド技術スタック

- **Supabase**: データベース・認証・リアルタイム機能
  - PostgreSQL データベース
  - Row Level Security (RLS) によるデータ保護
  - リアルタイムサブスクリプション
  - Auth機能（JWT認証）
- **Stripe**: 決済処理システム
  - Stripe Connect (家庭教師への支払い)
  - コイン購入処理
  - 決済履歴管理

### 11.3 開発環境・ツール

- **Metro Bundler**: React Nativeバンドラー
- **Babel**: JavaScript/TypeScriptトランスパイル
- **ESLint/Prettier**: コード品質・フォーマット（導入予定）
- **Expo Go**: 開発時テストアプリ
- **Expo Application Services (EAS)**: ビルド・デプロイ

### 11.4 アーキテクチャパターン

- **MVVMパターン**: View・ViewModel・Model分離
- **コンポーネント設計**: Atomic Design原則
- **状態管理**: Context API + useReducer
- **API設計**: RESTful API + リアルタイム更新

### 11.5 データ設計

- **型安全性**: TypeScript strict mode
- **スキーマ管理**: Supabaseスキーマ定義
- **バリデーション**: Runtime型チェック
- **エラーハンドリング**: 統一されたエラーレスポンス

### 11.6 パフォーマンス要件

- **初期ロード時間**: 3秒以内
- **FlatList仮想化**: 大量データ表示対応
- **画像最適化**: 適切なresizeMode・キャッシュ
- **メモ化**: React.memo、useMemo活用

### 11.7 品質保証

- **TypeScriptコンパイルエラー**: ゼロ
- **クロスプラットフォーム動作**: iOS/Android/Web
- **テスト自動化**: Jest + React Native Testing Library（導入予定）
- **E2Eテスト**: 主要ユーザーフロー（導入予定）

### 11.8 セキュリティ技術要件

- **データ暗号化**: AsyncStorage暗号化
- **API認証**: JWT Bearer token
- **入力サニタイゼーション**: 全ユーザー入力
- **HTTPS必須**: 全API通信
- **生体認証**: 指紋・Face ID統合（将来）

### 11.9 運用・保守要件

- **環境分離**: 開発・ステージング・本番
- **ログ管理**: 構造化ログ・エラートラッキング
- **監視**: アプリパフォーマンス・クラッシュレポート
- **CI/CD**: GitHub Actions（導入予定）
- **バックアップ**: データベース定期バックアップ

---

## 12. 変更履歴

- 2025-09-05 v1.0（MVP）: 2仕様を統合し、要件を再定義（技術実装は拘束しない）。
- 2025-09-06 v1.1: 技術要件を追加、Stripe Connect対応を明記。
